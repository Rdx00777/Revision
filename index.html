<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Premium Plus</title>
    
    <!-- React Framework -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons & Utilities -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');

        :root {
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1e293b;
        }

        /* Premium Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(4px);
        }

        .glass-dropdown {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .checkbox-wrapper input:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }

        /* Tag Colors */
        .tag-work { background-color: #e0e7ff; color: #4338ca; }
        .tag-personal { background-color: #fce7f3; color: #be185d; }
        .tag-health { background-color: #dcfce7; color: #15803d; }
        .tag-urgent { background-color: #fee2e2; color: #b91c1c; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Constants ---
        const TAGS = [
            { id: 'work', label: 'Work', color: 'bg-indigo-500', bg: 'bg-indigo-100', text: 'text-indigo-700' },
            { id: 'personal', label: 'Personal', color: 'bg-pink-500', bg: 'bg-pink-100', text: 'text-pink-700' },
            { id: 'health', label: 'Health', color: 'bg-emerald-500', bg: 'bg-emerald-100', text: 'text-emerald-700' },
            { id: 'urgent', label: 'Urgent', color: 'bg-red-500', bg: 'bg-red-100', text: 'text-red-700' },
        ];

        const REPEAT_OPTIONS = [
            { id: 'none', label: 'No Repeat' },
            { id: 'daily', label: 'Daily' },
            { id: 'weekly', label: 'Weekly' },
            { id: 'monthly', label: 'Monthly' },
        ];

        // --- Components ---

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-fade-in">
                    <div className="glass-panel w-full max-w-md rounded-2xl p-6 relative animate-slide-in">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                            <i data-lucide="x" className="w-5 h-5"></i>
                        </button>
                        <h2 className="text-xl font-bold mb-4 text-slate-800">{title}</h2>
                        {children}
                    </div>
                </div>
            );
        };

        const NotificationToast = ({ message, onClose }) => (
            <div className="fixed top-6 right-6 z-50 animate-slide-in">
                <div className="glass-panel px-6 py-4 rounded-2xl flex items-center gap-4 shadow-2xl border-l-4 border-l-indigo-500">
                    <div className="bg-indigo-100 p-2 rounded-full text-indigo-600">
                        <i data-lucide="bell" className="w-5 h-5"></i>
                    </div>
                    <div>
                        <h4 className="font-bold text-sm text-slate-800">Reminder</h4>
                        <p className="text-sm text-slate-600">{message}</p>
                    </div>
                    <button onClick={onClose} className="ml-2 hover:bg-slate-100 p-1 rounded-full transition">
                        <i data-lucide="x" className="w-4 h-4 text-slate-400"></i>
                    </button>
                </div>
            </div>
        );

        const DateBadge = ({ dateString, repeat }) => {
            if (!dateString) return null;
            const date = new Date(dateString);
            const now = new Date();
            
            const d = new Date(date).setHours(0,0,0,0);
            const n = new Date(now).setHours(0,0,0,0);
            
            const isToday = d === n;
            const isTomorrow = d === n + 86400000;
            const isOverdue = date < now && !isToday;

            let colorClass = "bg-indigo-100 text-indigo-600";
            let text = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            if (isOverdue) colorClass = "bg-red-100 text-red-600";
            else if (isToday) text = "Today, " + text;
            else if (isTomorrow) text = "Tmrw, " + text;
            else text = date.toLocaleDateString([], { month: 'short', day: 'numeric' }) + ", " + text;

            return (
                <div className="flex gap-1">
                    <span className={`text-xs font-semibold px-2.5 py-1 rounded-lg flex items-center gap-1.5 ${colorClass}`}>
                        <i data-lucide="clock" className="w-3 h-3"></i>
                        {text}
                    </span>
                    {repeat && repeat !== 'none' && (
                        <span className="text-xs font-semibold px-2 py-1 rounded-lg bg-slate-100 text-slate-500 flex items-center" title={`Repeats ${repeat}`}>
                            <i data-lucide="repeat" className="w-3 h-3"></i>
                        </span>
                    )}
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [tasks, setTasks] = useState(() => {
                const saved = localStorage.getItem('premium-todo-tasks-v2');
                return saved ? JSON.parse(saved) : [];
            });
            
            // Input States
            const [input, setInput] = useState('');
            const [dateInput, setDateInput] = useState('');
            const [selectedTag, setSelectedTag] = useState('personal');
            const [repeatMode, setRepeatMode] = useState('none');
            
            // UI States
            const [activeNotif, setActiveNotif] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [importError, setImportError] = useState('');
            const fileInputRef = useRef(null);

            const audioRef = useRef(null);

            // Initialize Icons
            useEffect(() => { window.lucide.createIcons(); });

            // Persistence
            useEffect(() => {
                localStorage.setItem('premium-todo-tasks-v2', JSON.stringify(tasks));
            }, [tasks]);

            // Reminder Logic
            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    tasks.forEach(task => {
                        if (task.reminder && !task.completed && !task.notified) {
                            const tDate = new Date(task.reminder);
                            if (now >= tDate && (now - tDate) < 60000) {
                                triggerAlert(task);
                            }
                        }
                    });
                }, 3000);
                return () => clearInterval(interval);
            }, [tasks]);

            const triggerAlert = (task) => {
                setActiveNotif(task.text);
                if(audioRef.current) audioRef.current.play().catch(() => {});
                setTasks(prev => prev.map(t => t.id === task.id ? { ...t, notified: true } : t));
                
                if ("Notification" in window && Notification.permission === "granted") {
                    new Notification("It's time!", { body: task.text });
                }
            };

            const addTask = (e) => {
                e.preventDefault();
                if (!input.trim()) return;

                const newTask = {
                    id: Date.now(),
                    text: input,
                    completed: false,
                    reminder: dateInput ? new Date(dateInput).toISOString() : null,
                    notified: false,
                    tag: selectedTag,
                    repeat: repeatMode,
                    createdAt: new Date().toISOString()
                };

                setTasks([newTask, ...tasks]);
                
                // Reset
                setInput('');
                // Keep date/tag/repeat selections for rapid entry? No, clear them for safety.
                setDateInput(''); 
                setRepeatMode('none');
                
                if(navigator.vibrate) navigator.vibrate(50);
            };

            const handleRepeatLogic = (task) => {
                if (!task.repeat || task.repeat === 'none' || !task.reminder) return;

                const oldDate = new Date(task.reminder);
                let newDate = new Date(oldDate);

                if (task.repeat === 'daily') newDate.setDate(oldDate.getDate() + 1);
                if (task.repeat === 'weekly') newDate.setDate(oldDate.getDate() + 7);
                if (task.repeat === 'monthly') newDate.setMonth(oldDate.getMonth() + 1);

                const nextTask = {
                    ...task,
                    id: Date.now(), // New ID
                    completed: false,
                    notified: false,
                    reminder: newDate.toISOString(),
                    createdAt: new Date().toISOString()
                };

                // Delay slightly so the user sees the checkmark first
                setTimeout(() => {
                    setTasks(prev => [nextTask, ...prev]);
                }, 500);
            };

            const toggleTask = (id) => {
                const task = tasks.find(t => t.id === id);
                if (!task.completed) {
                    // Celebrate
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.7 },
                        colors: ['#6366f1', '#8b5cf6', '#ec4899']
                    });
                    if(audioRef.current) {
                        audioRef.current.currentTime = 0;
                        audioRef.current.play();
                    }
                    
                    // Trigger repeat logic if applicable
                    handleRepeatLogic(task);
                }
                
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            const deleteTask = (id) => {
                if(confirm("Delete this task?")) {
                    setTasks(tasks.filter(t => t.id !== id));
                }
            };

            // Data Management
            const exportData = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tasks));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "taskmaster_backup_" + new Date().toISOString().slice(0,10) + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (Array.isArray(json)) {
                            setTasks(json);
                            setImportError('');
                            setShowSettings(false);
                            alert("Data imported successfully!");
                        } else {
                            setImportError("Invalid file format. Expected an array.");
                        }
                    } catch (err) {
                        setImportError("Error reading file: " + err.message);
                    }
                };
                reader.readAsText(file);
            };

            // Grouping
            const groupedTasks = useMemo(() => {
                const groups = {
                    overdue: [],
                    today: [],
                    tomorrow: [],
                    upcoming: [],
                    noDate: [],
                    completed: []
                };

                const now = new Date();
                now.setHours(0,0,0,0);

                tasks.forEach(task => {
                    if (task.completed) {
                        groups.completed.push(task);
                        return;
                    }
                    if (!task.reminder) {
                        groups.noDate.push(task);
                        return;
                    }
                    const tDate = new Date(task.reminder);
                    const tDateMidnight = new Date(task.reminder);
                    tDateMidnight.setHours(0,0,0,0);

                    if (tDate < new Date() && tDateMidnight.getTime() !== now.getTime()) {
                        groups.overdue.push(task);
                    } else if (tDateMidnight.getTime() === now.getTime()) {
                        groups.today.push(task);
                    } else if (tDateMidnight.getTime() === now.getTime() + 86400000) {
                        groups.tomorrow.push(task);
                    } else {
                        groups.upcoming.push(task);
                    }
                });
                return groups;
            }, [tasks]);

            const renderTaskGroup = (title, list, icon, color) => {
                if (list.length === 0) return null;
                return (
                    <div className="mb-6 animate-slide-in">
                        <h3 className={`text-sm font-bold uppercase tracking-wider mb-3 flex items-center gap-2 ${color}`}>
                            <i data-lucide={icon} className="w-4 h-4"></i>
                            {title} <span className="opacity-50 ml-1">({list.length})</span>
                        </h3>
                        <div className="space-y-3">
                            {list.map(task => {
                                const tagStyle = TAGS.find(t => t.id === task.tag) || TAGS[0];
                                return (
                                    <div key={task.id} className="glass-panel p-4 rounded-xl hover:scale-[1.01] transition-all duration-200 group relative overflow-hidden">
                                        {/* Tag Strip */}
                                        <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${tagStyle.color}`}></div>
                                        
                                        <div className="flex items-start gap-3 pl-2">
                                            <label className="checkbox-wrapper relative cursor-pointer pt-1">
                                                <input 
                                                    type="checkbox" 
                                                    className="peer sr-only"
                                                    checked={task.completed}
                                                    onChange={() => toggleTask(task.id)}
                                                />
                                                <div className="w-5 h-5 border-2 border-slate-300 rounded-full peer-hover:border-indigo-400 transition-all flex items-center justify-center">
                                                    <i data-lucide="check" className="w-3 h-3 text-white opacity-0 peer-checked:opacity-100"></i>
                                                </div>
                                            </label>
                                            
                                            <div className="flex-1 min-w-0">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <p className={`font-medium text-slate-700 leading-snug transition-all truncate ${task.completed ? 'line-through text-slate-400' : ''}`}>
                                                        {task.text}
                                                    </p>
                                                    <span className={`text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${tagStyle.bg} ${tagStyle.text}`}>
                                                        {tagStyle.label}
                                                    </span>
                                                </div>
                                                <DateBadge dateString={task.reminder} repeat={task.repeat} />
                                            </div>

                                            <button onClick={() => deleteTask(task.id)} className="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition-opacity p-1">
                                                <i data-lucide="trash" className="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen py-8 px-4 md:px-8 max-w-3xl mx-auto pb-32">
                    <audio ref={audioRef} src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>
                    
                    {activeNotif && <NotificationToast message={activeNotif} onClose={() => setActiveNotif(null)} />}

                    {/* Settings Modal */}
                    <Modal isOpen={showSettings} onClose={() => setShowSettings(false)} title="Data Settings">
                        <div className="space-y-4">
                            <div className="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                <h3 className="font-semibold text-slate-700 mb-2">Backup Data</h3>
                                <p className="text-sm text-slate-500 mb-3">Download your tasks to transfer them to another device.</p>
                                <button onClick={exportData} className="w-full bg-slate-800 text-white py-2 rounded-lg hover:bg-slate-900 transition flex items-center justify-center gap-2">
                                    <i data-lucide="download" className="w-4 h-4"></i> Export JSON
                                </button>
                            </div>
                            
                            <div className="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                <h3 className="font-semibold text-slate-700 mb-2">Restore Data</h3>
                                <p className="text-sm text-slate-500 mb-3">Upload a previously exported JSON file. <span className="text-red-500">Warning: This replaces current tasks.</span></p>
                                <input 
                                    type="file" 
                                    accept=".json"
                                    ref={fileInputRef}
                                    onChange={importData}
                                    className="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                                />
                                {importError && <p className="text-xs text-red-500 mt-2">{importError}</p>}
                            </div>
                        </div>
                    </Modal>

                    {/* Header */}
                    <header className="mb-8 text-white flex justify-between items-start">
                        <div>
                            <h1 className="text-4xl md:text-5xl font-bold mb-2">Tasks.</h1>
                            <p className="text-indigo-200 text-lg">Focus on what matters.</p>
                        </div>
                        <button 
                            onClick={() => setShowSettings(true)}
                            className="p-2 rounded-full hover:bg-white/10 transition"
                            title="Settings"
                        >
                            <i data-lucide="settings" className="w-6 h-6"></i>
                        </button>
                    </header>

                    {/* Input Area - Expanded Controls */}
                    <div className="glass-panel p-4 rounded-2xl mb-10 shadow-2xl shadow-indigo-900/20 space-y-3">
                        <input 
                            type="text" 
                            value={input}
                            onChange={e => setInput(e.target.value)}
                            placeholder="Add a new task..."
                            className="w-full bg-transparent border-b border-slate-200/50 px-2 py-2 text-lg placeholder:text-slate-400 text-slate-800 outline-none focus:border-indigo-500 transition-colors"
                            onKeyPress={e => e.key === 'Enter' && addTask(e)}
                        />
                        
                        <div className="flex flex-wrap items-center gap-2 md:gap-4">
                            {/* Date Input */}
                            <div className="flex-1 min-w-[140px]">
                                <div className="relative">
                                    <i data-lucide="calendar" className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                                    <input 
                                        type="datetime-local" 
                                        value={dateInput}
                                        onChange={e => setDateInput(e.target.value)}
                                        className="w-full pl-9 pr-3 py-2 rounded-lg bg-slate-50/50 border border-slate-200 text-sm text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500/50"
                                    />
                                </div>
                            </div>

                            {/* Tag Select */}
                            <div className="relative group">
                                <select 
                                    value={selectedTag}
                                    onChange={e => setSelectedTag(e.target.value)}
                                    className="appearance-none pl-9 pr-8 py-2 rounded-lg bg-slate-50/50 border border-slate-200 text-sm text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500/50 cursor-pointer hover:bg-slate-100"
                                >
                                    {TAGS.map(tag => <option key={tag.id} value={tag.id}>{tag.label}</option>)}
                                </select>
                                <i data-lucide="tag" className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"></i>
                                <div className={`absolute left-3 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full hidden ${TAGS.find(t=>t.id === selectedTag)?.color}`}></div>
                            </div>

                            {/* Repeat Select */}
                            <div className="relative">
                                <select 
                                    value={repeatMode}
                                    onChange={e => setRepeatMode(e.target.value)}
                                    className={`appearance-none pl-9 pr-8 py-2 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-indigo-500/50 cursor-pointer transition-colors ${repeatMode !== 'none' ? 'bg-indigo-50 border-indigo-200 text-indigo-600' : 'bg-slate-50/50 border-slate-200 text-slate-600'}`}
                                >
                                    {REPEAT_OPTIONS.map(opt => <option key={opt.id} value={opt.id}>{opt.label}</option>)}
                                </select>
                                <i data-lucide="repeat" className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 pointer-events-none ${repeatMode !== 'none' ? 'text-indigo-500' : 'text-slate-400'}`}></i>
                            </div>

                            <button 
                                onClick={addTask}
                                disabled={!input.trim()}
                                className="ml-auto bg-indigo-600 hover:bg-indigo-700 text-white p-2.5 rounded-lg transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-500/30"
                            >
                                <i data-lucide="plus" className="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    {/* Tasks Feed */}
                    <div className="space-y-2 pb-10">
                        {tasks.length === 0 && (
                            <div className="text-center py-20 text-indigo-200/50">
                                <i data-lucide="layout-list" className="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                <p className="text-xl">Your schedule is clear.</p>
                            </div>
                        )}

                        {renderTaskGroup("Overdue", groupedTasks.overdue, "alert-circle", "text-red-400")}
                        {renderTaskGroup("Today", groupedTasks.today, "sun", "text-indigo-300")}
                        {renderTaskGroup("Tomorrow", groupedTasks.tomorrow, "arrow-right-circle", "text-purple-300")}
                        {renderTaskGroup("Upcoming", groupedTasks.upcoming, "calendar", "text-slate-400")}
                        {renderTaskGroup("No Date", groupedTasks.noDate, "inbox", "text-slate-400")}
                        
                        {/* Completed Section */}
                        {groupedTasks.completed.length > 0 && (
                            <div className="mt-12 pt-8 border-t border-white/10">
                                <div className="opacity-60 hover:opacity-100 transition-opacity">
                                     {renderTaskGroup("Completed", groupedTasks.completed, "check-circle-2", "text-emerald-400")}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


